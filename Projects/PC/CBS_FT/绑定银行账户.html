<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="robots" content="index,follow">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!--meta(name='full-screen' content='yes')-->
    <!--meta(name='x5-fullscreen' content='true')-->
    <meta content="telephone=no, email=no" name="format-detection">
    <link rel="stylesheet" href="style/sm.min.css">
    <link rel="stylesheet" href="style/style.css">
    <script src="js/lib/zepto.min.js"></script>
    <script>$.config = {router: false}</script>
    <title>绑定银行账户</title>
  </head>
  <body>
    <aside class="sideMenu">
      <div class="container"><a class="personalCenter-trig active" href="账户安全.html">
          <div class="avatar">
            <div class="ribbon">
              <div class="ribbon-cont">机构会员</div>
            </div>
          </div>
          <p class="user-name">FT_123456_0223</p></a>
        <nav class="nav"><a class="nav-item" href="index.html"><i class="iconfont icon-histogram-1"></i>
            <p>稳健理财</p></a><a class="nav-item" href="安享活期.html"><i class="iconfont icon-update"></i>
            <p>安享活期</p></a><a class="nav-item" href="我的资产.html"><i class="iconfont icon-rmb-big"></i>
            <p>我的资产</p></a>
        </nav><a class="setting-trig" href="关于CBS.html"><i class="iconfont icon-setting"></i></a>
      </div>
    </aside>
    <aside class="floatBar">
      <div class="container">
        <div class="default-cont">
          <div class="current-time"></div>
          <div class="current-date"></div>
        </div>
        <div class="expanded-cont">
          <div class="float-menu"><a class="menu-item" href="index.html"><i class="iconfont icon-index"></i>
              <p>首页</p></a></div>
        </div>
      </div>
    </aside>
    <div class="page-group">
      <div class="page page-current">
        <header class="bar bar-nav title-bar"><a class="icon icon-left pull-left back" href="javascript:;"></a>
          <h2 class="title">绑定银行账户</h2>
        </header>
        <div class="content">
          <div class="y-wrap01 mt60">
            <div class="list-block form-sec01">
              <div class="form-item">
                <div class="item-content">
                  <div class="item-inner">
                    <div class="item-title label">开户行：</div>
                    <div class="item-input">
                      <input class="y-hidden-input" id="selectAccountBank" type="text" name="bank">
                      <div class="selected-bank"><img src="images/cmcb.png"></div>
                      <p class="y-tip01">此银行卡支持在线支付</p>
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-item">
                <div class="item-content">
                  <div class="item-inner">
                    <div class="item-title label">公司名称：</div>
                    <div class="item-input">
                      <p>******钱端商务</p>
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-item">
                <div class="item-content">
                  <div class="item-inner">
                    <div class="item-title label">银行账户：</div>
                    <div class="item-input">
                      <input class="y-inp-txt" id="debitAccount" type="text" placeholder="请输入银行账户"><a class="iconfont icon-clear y-clear" href="javascript:;"></a>
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-item">
                <div class="item-content">
                  <div class="item-inner">
                    <div class="item-title label">开户省市：</div>
                    <div class="item-input">
                      <label class="y-select-box">
                        <input class="y-inp-txt" id="provincialCity" type="text" required readonly placeholder="请选择省市">
                      </label>
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-item">
                <div class="item-content">
                  <div class="item-inner">
                    <div class="item-title label">开户支行：</div>
                    <div class="item-input y-flex-wrap" id="accBranchBank">
                      <div class="y-bd">
                        <input class="y-inp-txt" id="selectedBranchBank" type="text" readonly placeholder="请选择开户支行">
                      </div>
                      <div class="y-ft"><a class="y-btn02" href="javascript:;">检索</a></div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-item sp-1">
                <div class="item-content">
                  <div class="item-inner">
                    <div class="item-title label"></div>
                    <div class="item-input"><a class="y-btn01 mb-dft disabled" id="finishTrig" href="银行账户管理.html">完成</a>
                      <p class="y-tip01">请确认银行账户信息准确无误，通过后将不能修改！</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--选择开户支行-->
    <div class="sp-modal" id="selectAccBranchBank">
      <div class="sp-modal-overlay"></div>
      <div class="sp-modal-cont">
        <div class="sp-modal-title">
          <h3>选择支行</h3><a class="sp-modal-close" href="javascript:;"></a>
        </div>
        <div class="sp-modal-inner">
          <div class="y-flex-wrap">
            <div class="y-bd">
              <input class="y-inp-txt" id="searchBranchBankInput" type="text"><a class="iconfont icon-clear y-clear" href="javascript:;"></a>
            </div>
            <div class="y-ft"><a class="y-btn02 fill" id="searchBranchBankTrig" href="javascript:;">检索</a></div>
          </div>
          <div class="branchBank-list">
            <div class="y-header">
              <div class="y-bd">全称</div>
              <div class="y-ft">操作</div>
            </div>
            <div class="y-body" id="branchBankDisplay">
              <ul>
                <li class="branchBank-item">
                  <div class="y-bd branchBankName">招商银行股份有限公司北京青年路支行-1</div>
                  <div class="y-ft"><a class="y-btn03 selectBankTrig" href="javascript:;">选择</a></div>
                </li>
                <li class="branchBank-item">
                  <div class="y-bd branchBankName">招商银行股份有限公司北京青年路支行-2</div>
                  <div class="y-ft"><a class="y-btn03 selectBankTrig" href="javascript:;">选择</a></div>
                </li>
                <li class="branchBank-item">
                  <div class="y-bd branchBankName">招商银行股份有限公司北京青年路支行-3</div>
                  <div class="y-ft"><a class="y-btn03 selectBankTrig" href="javascript:;">选择</a></div>
                </li>
                <li class="branchBank-item">
                  <div class="y-bd branchBankName">招商银行股份有限公司北京青年路支行-4</div>
                  <div class="y-ft"><a class="y-btn03 selectBankTrig" href="javascript:;">选择</a></div>
                </li>
                <li class="branchBank-item">
                  <div class="y-bd branchBankName">招商银行股份有限公司北京青年路支行-5</div>
                  <div class="y-ft"><a class="y-btn03 selectBankTrig" href="javascript:;">选择</a></div>
                </li>
                <li class="branchBank-item">
                  <div class="y-bd branchBankName">招商银行股份有限公司北京青年路支行-6</div>
                  <div class="y-ft"><a class="y-btn03 selectBankTrig" href="javascript:;">选择</a></div>
                </li>
                <li class="branchBank-item">
                  <div class="y-bd branchBankName">招商银行股份有限公司北京青年路支行-7</div>
                  <div class="y-ft"><a class="y-btn03 selectBankTrig" href="javascript:;">选择</a></div>
                </li>
                <li class="branchBank-item">
                  <div class="y-bd branchBankName">招商银行股份有限公司北京青年路支行-8</div>
                  <div class="y-ft"><a class="y-btn03 selectBankTrig" href="javascript:;">选择</a></div>
                </li>
              </ul>
            </div>
          </div>
          <p class="y-para01 mt30 mb30">注意：请使用检索功能选择支行信息，如果检索不到，请在下方填写完整的支行信息！<em class='c_666'>填写格式：招商银行股份有限公司 广州体育东路支行</em></p>
          <div class="y-flex-wrap">
            <div class="y-bd">
              <input class="y-inp-txt" id="manualInput" type="text"><a class="iconfont icon-clear y-clear" href="javascript:;"></a>
            </div>
            <div class="y-ft"><a class="y-btn02" id="confirmManualInput" href="javascript:;">确定</a></div>
          </div>
        </div>
      </div>
    </div>
    <script src="js/lib/sm.min.js"></script>
    <script src="js/common.js"></script>
    <script src="js/components/sm-city-picker.min.js"></script>
    <script src="js/components/dropload.min.js"></script>
    <script>
      $(function () {
        //选择开户行
        $("#selectAccountBank").picker({
          toolbarTemplate: '<header class="bar bar-nav">\
          <button class="button button-link pull-right close-picker">确定</button>\
          </header>',
          cols: [
            {
              textAlign: 'center',
              values: ['images/cmcb.png', 'images/bof.png', 'images/zsyx.png'],
              displayValues: ['<img src=\"images/cmcb.png\">', '<img src=\"images/bof.png\">', '<img src=\"images/zsyx.png\">']
            }
          ],
          cssClass: 'ch-picker-items'
        }).on("change", function () {
          $(this).siblings(".selected-bank").find('img').attr("src", $(this).val());
        });
      
        //选择省市
        $('#provincialCity').cityPicker({
          toolbarTemplate: '<header class="bar bar-nav">\
              <button class="button button-link pull-right close-picker">确定</button>\
              <h1 class="title">请选择省市</h1>\
              </header>'
        });
      
        //选择开户支行
        (function () {
          var $pa = $('#selectAccBranchBank'),
            $selectAccountBank = $('#selectAccountBank'),
            $debitAccount = $('#debitAccount'),
            $provincialCity = $('#provincialCity'),
            $selectedBranchBank = $('#selectedBranchBank'),
            $branchBankDisplay = $('#branchBankDisplay'),
            $searchBranchBankInput = $('#searchBranchBankInput'),
            $manualInput = $('#manualInput'),
            $finishTrig = $('#finishTrig'),
            _options = {};
      
          //判断下一步
          function checkNext() {
            if ($debitAccount.val() != '' && $provincialCity.val() && $selectedBranchBank.val()) {
              $finishTrig.removeClass('disabled');
            } else {
              $finishTrig.addClass('disabled');
            }
          }
      
          //监视各输入框状态, 判断是否能进入下一步
          $selectAccountBank.on('change', checkNext);
          $debitAccount.on('keyup change blur', checkNext);
          $provincialCity.on('change', checkNext);
      
          $('#accBranchBank').on('click', function () {
            specModal('#selectAccBranchBank');
          }).one('click', function () {
            _options = {
              threshold: 300,
              loadDownFn: function (me) {
                page++;
                $.ajax({
                  type: 'GET',
                  url: 'js/json/branch_bank_list.json',
                  dataType: 'json',
                  success: function (data) {
                    var result = '',
                        dataLen = data.branchBankList.length;
      
                    if (dataLen > 0) {
                      for (var i = 0; i < dataLen; i++) {
                        result += '<li class="branchBank-item">' +
                            '<div class="y-bd branchBankName">' + data.branchBankList[i].name + '</div>' +
                            '<div class="y-ft"><a class="y-btn03 selectBankTrig" href="javascript:;">选择</a></div>' +
                            '</li>';
                      }
                    } else {
                      // 锁定
                      me.lock();
                      // 无数据
                      me.noData();
                    }
                    // 为了测试，延迟1秒加载
                    setTimeout(function () {
                      $branchBankDisplay.find('ul').append(result);
                      // 每次数据加载完，必须重置
                      me.resetload();
                    }, 1000);
                  },
                  error: function (xhr, type) {
                    alert('Ajax error!');
                    // 即使加载出错，也得重置
                    me.resetload();
                  }
                });
              }
            };
            loadBranchBank.init(_options);
          });
      
          //加载更多支行数据
          var page = 0;
          //每次加载的数据条数
          var size = 4;
          var loadBranchBank = $branchBankDisplay.dropload(_options);
      
          //完成选择或取消选择
          function clearInputs() {
            $searchBranchBankInput.val('');
            $manualInput.val('');
            $pa.find('.y-clear').hide();
            checkNext();
          }
          var doneSelecting = function () {
            $branchBankDisplay.find('.branchBank-item').removeClass('hide');
            clearInputs();
            closeSpecModal('#selectAccBranchBank');
          };
          $pa.find('.sp-modal-close').bind('click', function () {
            clearInputs();
          });
      
          //检索支行
          $('#searchBranchBankTrig').on('click', function () {
            var targetText = $searchBranchBankInput.val(),
                testString = '',
                $branchBankItemSet = $branchBankDisplay.find('.branchBank-item');
            if (!targetText) {
              $branchBankItemSet.removeClass('hide');
            }
            $branchBankItemSet.each(function () {
              testString = $(this).find('.branchBankName').text();
              if (testString.indexOf(targetText) < 0) {
                $(this).addClass('hide');
              }
            });
          });
          //点选支行
          $branchBankDisplay.on('click', '.selectBankTrig', function () {
            var selectedResult = $(this).parents('.branchBank-item').find('.branchBankName').text();
            $selectedBranchBank.val(selectedResult);
            doneSelecting();
          });
          //手动输入支行
          $('#confirmManualInput').on('click', function () {
            $selectedBranchBank.val($manualInput.val());
            doneSelecting();
          });
        })();
      
      });
    </script>
  </body>
</html>